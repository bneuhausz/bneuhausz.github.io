<!DOCTYPE html><html lang="en"><head>
    <meta charset="utf-8">
    <title>Markdown copy code button in Angular - bneuhausz.dev</title>
    <base href="/">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="impact-site-verification" value="fadbe9c7-c2b6-4441-b7ef-92e28101384e">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <script defer="" type="application/javascript" src="javascript/klaro/config.js"></script>
    <!-- <script defer src="/javascript/klaro/klaro.js"></script> -->
    <script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1479748760290806" crossorigin="anonymous">
    </script>
    <script>
      (function(w,d,e,u,f,l,n){w[f]=w[f]||function(){(w[f].q=w[f].q||[])
      .push(arguments);},l=d.createElement(e),l.async=1,l.src=u,
      n=d.getElementsByTagName(e)[0],n.parentNode.insertBefore(l,n);})
      (window,document,'script','https://assets.mailerlite.com/js/universal.js','ml');
      ml('account', '1754906');
    </script>
    <script type="module" crossorigin="" src="/assets/index-Ds1THEmd.js"></script>
    <link rel="stylesheet" crossorigin="" href="/assets/index-guJYqCx_.css">
  <style ng-app-id="ng">[_nghost-ng-c572653062]{display:inline-block;width:var(--ng-icon__size, 1em);height:var(--ng-icon__size, 1em);line-height:initial;vertical-align:initial;overflow:hidden}[_nghost-ng-c572653062]     svg{width:inherit;height:inherit;vertical-align:inherit}@layer ng-icon{[_nghost-ng-c572653062]{color:var(--ng-icon__color, currentColor)}}</style><meta name="description" content="We'll implement an Angular directive that adds a copy button to code blocks in markdown, utilizing Analog, Tailwind CSS and daisyUI"><meta property="og:title" content="Markdown copy code button in Angular"><meta property="og:description" content="We'll implement an Angular directive that adds a copy button to code blocks in markdown, utilizing Analog, Tailwind CSS and daisyUI"><meta property="og:image" content="https://bneuhausz.dev/images/bneuhausz_dev_twitter.png"><meta property="og:image:alt" content="bneuhausz.dev site logo"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="Markdown copy code button in Angular"><meta name="twitter:description" content="We'll implement an Angular directive that adds a copy button to code blocks in markdown, utilizing Analog, Tailwind CSS and daisyUI"><meta name="twitter:image" content="https://bneuhausz.dev/images/bneuhausz_dev_twitter.png"><meta name="twitter:image:alt" content="bneuhausz.dev site logo"><script type="application/ld+json" id="blogpost-ldjson">{"@context":"https://schema.org","@type":"BlogPosting","headline":"Markdown copy code button in Angular","image":"/images/angular_gradient_thumbnail.avif","author":{"@type":"Person","name":"Bálint Neuhausz","url":"https://bneuhausz.dev"},"publisher":{"@type":"Organization","name":"bneuhausz.dev","logo":{"@type":"ImageObject","url":"https://bneuhausz.dev/images/nb_logo_small.avif"}},"datePublished":"2025-08-21T00:00:00.000Z","description":"We'll implement an Angular directive that adds a copy button to code blocks in markdown, utilizing Analog, Tailwind CSS and daisyUI"}</script><link rel="canonical" href="https://yourdomain.com/blog/angular-copy-code-markdown"></head>
  <body class="text-center h-screen w-screen overflow-x-hidden"><!--nghm-->
    <app-root ng-version="19.2.9" class="flex flex-col h-screen" ngh="3" ng-server-context="ssr-analog"><appheader ngh="0"><nav class="navbar bg-neutral text-amber-100 gap-2 px-8"><a routerlink="/" href="/"><img src="/images/nb_logo_small.avif" alt="logo of the site"></a><a routerlink="/blog" class="btn btn-square btn-ghost hover:bg-amber-100 hover:text-amber-900 px-8" href="/blog"> Blog </a><a routerlink="/about" class="btn btn-square btn-ghost hover:bg-amber-100 hover:text-amber-900 px-8" href="/about"> About </a><span class="flex-1"></span><a href="https://github.com/bneuhausz" target="_blank" rel="noopener"><div class="w-5 h-5 ml-3 bg-amber-100 github-icon"></div></a><a href="mailto:bneuhauszdev@gmail.com" class="flex items-center ml-3"><ng-icon role="img" name="heroEnvelopeSolid" _nghost-ng-c572653062="" aria-hidden="true" data-ng-icon-ssr="" style="--ng-icon__size: 1.5em;" ngh="0"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon"><path d="M1.5 8.67v8.58a3 3 0 0 0 3 3h15a3 3 0 0 0 3-3V8.67l-8.928 5.493a3 3 0 0 1-3.144 0L1.5 8.67Z"></path><path d="M22.5 6.908V6.75a3 3 0 0 0-3-3h-15a3 3 0 0 0-3 3v.158l9.714 5.978a1.5 1.5 0 0 0 1.572 0L22.5 6.908Z"></path></svg></ng-icon></a></nav></appheader><main class="flex-1 py-4 md:px-4 bg-neutral-800 text-amber-100"><router-outlet></router-outlet><div slug="" ngh="2"><article class="flex flex-col items-center *:max-w-screen-xl *:mx-8 md:*:mx-32 pb-8"><img sizes="(max-width: 1280px) 100vw, 1280px" class="w-full h-auto" srcset="/images/angular_wordmark_gradient_header_small.avif 480w, /images/angular_wordmark_gradient_header_medium.avif 800w, /images/angular_wordmark_gradient_header.avif 1280w" src="/images/angular_wordmark_gradient_header.avif" alt="angular gradient image"><p class="flex flex-row items-center my-4"><span>2025-08-21</span><a href="https://github.com/bneuhausz" target="_blank" rel="noopener" class="flex items-center"><span class="w-5 h-5 ml-3 bg-amber-100 github-icon"></span></a><a href="mailto:bneuhauszdev@gmail.com" class="flex items-center ml-3"><ng-icon role="img" name="heroEnvelopeSolid" _nghost-ng-c572653062="" aria-hidden="true" data-ng-icon-ssr="" style="--ng-icon__size: 1.5em;" ngh="0"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon"><path d="M1.5 8.67v8.58a3 3 0 0 0 3 3h15a3 3 0 0 0 3-3V8.67l-8.928 5.493a3 3 0 0 1-3.144 0L1.5 8.67Z"></path><path d="M22.5 6.908V6.75a3 3 0 0 0-3-3h-15a3 3 0 0 0-3 3v.158l9.714 5.978a1.5 1.5 0 0 0 1.572 0L22.5 6.908Z"></path></svg></ng-icon></a></p><div appcodecopybutton="" appexternallinks="" class="prose dark:prose-invert text-left mb-8"><analog-markdown ngh="1"><div class="analog-markdown"><h1 id="markdown-copy-code-button-in-angular">Markdown copy code button in Angular</h1>
<h2 id="basic-setup">Basic Setup</h2>
<p>This app you're browsing right now is built with Analog, Tailwind CSS and daisyUI. The attribute we will take a look at is part of this app, so we will take the usage of the above technologies a given, but the actual use case is not technology specific, so you may still find it useful. A complete, working example can be found in the <a href="https://github.com/bneuhausz/bneuhausz.github.io">source code of this site.</a></p><h2 id="the-code-of-the-directive">The code of the directive</h2>
<p>First, I'll show you the complete code of this attribute, then we'll go through it together.</p><pre class="shiki github-dark" style="background-color:#24292e;color:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> { Directive, ElementRef, AfterViewInit, Renderer2, inject } </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> '@angular/core'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> { isBrowser } </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> '../utils/browser.utils'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">@</span><span style="color:#B392F0">Directive</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#E1E4E8">  selector: </span><span style="color:#9ECBFF">'[appCodeCopyButton]'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">})</span></span>
<span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> CodeCopyButtonDirective</span><span style="color:#F97583"> implements</span><span style="color:#B392F0"> AfterViewInit</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  private</span><span style="color:#F97583"> readonly</span><span style="color:#FFAB70"> el</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> inject</span><span style="color:#E1E4E8">(ElementRef);</span></span>
<span class="line"><span style="color:#F97583">  private</span><span style="color:#F97583"> readonly</span><span style="color:#FFAB70"> renderer</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> inject</span><span style="color:#E1E4E8">(Renderer2);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">  ngAfterViewInit</span><span style="color:#E1E4E8">()</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> void</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">!</span><span style="color:#B392F0">isBrowser</span><span style="color:#E1E4E8">()) </span><span style="color:#F97583">return</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> observer</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> MutationObserver</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=&gt;</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> preElements</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.el.nativeElement.</span><span style="color:#B392F0">querySelectorAll</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'pre'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">      if</span><span style="color:#E1E4E8"> (preElements.</span><span style="color:#79B8FF">length</span><span style="color:#F97583"> ===</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">return</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">      preElements.</span><span style="color:#B392F0">forEach</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">pre</span><span style="color:#F97583">:</span><span style="color:#B392F0"> HTMLPreElement</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=&gt;</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">        if</span><span style="color:#E1E4E8"> (pre.</span><span style="color:#B392F0">querySelector</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'button'</span><span style="color:#E1E4E8">)) </span><span style="color:#F97583">return</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.renderer.</span><span style="color:#B392F0">setAttribute</span><span style="color:#E1E4E8">(pre, </span><span style="color:#9ECBFF">'class'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'relative pt-8'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">        const</span><span style="color:#79B8FF"> button</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.renderer.</span><span style="color:#B392F0">createElement</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'button'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.renderer.</span><span style="color:#B392F0">setAttribute</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#E1E4E8">          button,</span></span>
<span class="line"><span style="color:#9ECBFF">          'class'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">          'btn btn-xs btn-ghost absolute top-1 right-2 z-10'</span></span>
<span class="line"><span style="color:#E1E4E8">        );</span></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.renderer.</span><span style="color:#B392F0">setProperty</span><span style="color:#E1E4E8">(button, </span><span style="color:#9ECBFF">'textContent'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'Copy'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.renderer.</span><span style="color:#B392F0">appendChild</span><span style="color:#E1E4E8">(pre, button);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF">        this</span><span style="color:#E1E4E8">.renderer.</span><span style="color:#B392F0">listen</span><span style="color:#E1E4E8">(button, </span><span style="color:#9ECBFF">'click'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=&gt;</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">handleCopyButtonClick</span><span style="color:#E1E4E8">(pre, button));</span></span>
<span class="line"><span style="color:#E1E4E8">      });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">      observer.</span><span style="color:#B392F0">disconnect</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">    });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">    observer.</span><span style="color:#B392F0">observe</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.el.nativeElement, {</span></span>
<span class="line"><span style="color:#E1E4E8">      childList: </span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">      subtree: </span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    });</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">  private</span><span style="color:#B392F0"> handleCopyButtonClick</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">pre</span><span style="color:#F97583">:</span><span style="color:#B392F0"> HTMLPreElement</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">button</span><span style="color:#F97583">:</span><span style="color:#B392F0"> HTMLButtonElement</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> void</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> code</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> pre.</span><span style="color:#B392F0">querySelector</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'code'</span><span style="color:#E1E4E8">)?.textContent </span><span style="color:#F97583">??</span><span style="color:#9ECBFF"> ''</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    navigator.clipboard.</span><span style="color:#B392F0">writeText</span><span style="color:#E1E4E8">(code);</span></span>
<span class="line"><span style="color:#E1E4E8">    button.textContent </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> 'Copied!'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">resetButtonText</span><span style="color:#E1E4E8">(button);</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">  private</span><span style="color:#B392F0"> resetButtonText</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">button</span><span style="color:#F97583">:</span><span style="color:#B392F0"> HTMLButtonElement</span><span style="color:#E1E4E8">)</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> void</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">    setTimeout</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=&gt;</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">      button.textContent </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> 'Copy'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">    }, </span><span style="color:#79B8FF">2000</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h2 id="explanation">Explanation</h2>
<p>Now let's break this all down. Well, most of it anyway.</p><h3 id="directive-decorator">Directive decorator</h3>
<pre class="shiki github-dark" style="background-color:#24292e;color:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#E1E4E8">@</span><span style="color:#B392F0">Directive</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#E1E4E8">  selector: </span><span style="color:#9ECBFF">'[appCodeCopyButton]'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">})</span></span></code></pre>
<p>There is nothing exciting going on here, it's just a standard Angular directive utilizing an attribute selector, which enables the usage of this directive as follows:</p><pre class="shiki github-dark" style="background-color:#24292e;color:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#E1E4E8">&lt;</span><span style="color:#85E89D">div</span><span style="color:#B392F0"> appCodeCopyButton</span><span style="color:#E1E4E8">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8">  &lt;</span><span style="color:#85E89D">analog-markdown</span><span style="color:#B392F0"> [content]</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"post.content"</span><span style="color:#E1E4E8"> /&gt;</span></span>
<span class="line"><span style="color:#E1E4E8">&lt;/</span><span style="color:#85E89D">div</span><span style="color:#E1E4E8">&gt;</span></span></code></pre>
<h3 id="class-definition">Class definition</h3>
<pre class="shiki github-dark" style="background-color:#24292e;color:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> CodeCopyButtonDirective</span><span style="color:#F97583"> implements</span><span style="color:#B392F0"> AfterViewInit</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  private</span><span style="color:#F97583"> readonly</span><span style="color:#FFAB70"> el</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> inject</span><span style="color:#E1E4E8">(ElementRef);</span></span>
<span class="line"><span style="color:#F97583">  private</span><span style="color:#F97583"> readonly</span><span style="color:#FFAB70"> renderer</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> inject</span><span style="color:#E1E4E8">(Renderer2);</span></span>
<span class="line"><span style="color:#B392F0">  ngAfterViewInit</span><span style="color:#E1E4E8">()</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> void</span><span style="color:#E1E4E8"> { }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>Again, this is fairly basic. Our class implements the <code>AfterViewInit</code> interface and uses this lifecycle hook provided by Angular. Basically, everything inside <code>ngAfterViewInit</code> will run once, after Angular finished initialaizing the views of the component and its children.</p><p>We inject <code>ElementRef</code> to get access to the host HTML element our directibe is attached to. In our case, it's the div element:</p><pre class="shiki github-dark" style="background-color:#24292e;color:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#E1E4E8">&lt;</span><span style="color:#85E89D">div</span><span style="color:#B392F0"> appCodeCopyButton</span><span style="color:#E1E4E8">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8">  &lt;</span><span style="color:#85E89D">analog-markdown</span><span style="color:#B392F0"> [content]</span><span style="color:#E1E4E8">=</span><span style="color:#9ECBFF">"post.content"</span><span style="color:#E1E4E8"> /&gt;</span></span>
<span class="line"><span style="color:#E1E4E8">&lt;/</span><span style="color:#85E89D">div</span><span style="color:#E1E4E8">&gt;</span></span></code></pre>
<p>We'll allso need to inject <code>Renderer2</code>. No, it is not a typo, it really is called <code>Renderer2</code>. It is a service provided by Angular that provides a safe way to manipulate DOM elements, regardless of the environment.</p><h3 id="the-actual-logic">The actual logic</h3>
<h4 id="big-picture-view">Big picture view</h4>
<p>The logic inside <code>ngAfterViewInit</code> starts with this line:</p><pre class="shiki github-dark" style="background-color:#24292e;color:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#F97583">if</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">!</span><span style="color:#B392F0">isBrowser</span><span style="color:#E1E4E8">()) </span><span style="color:#F97583">return</span><span style="color:#E1E4E8">;</span></span></code></pre>
<p>This is just a handy utility function that you can straight up ignore if you are not using server side rendering. This line basically stops execution, if the <code>window</code> or <code>document</code> objects are undefined, meaning, the app is not running in a browser.</p><pre class="shiki github-dark" style="background-color:#24292e;color:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#F97583">export</span><span style="color:#F97583"> const</span><span style="color:#B392F0"> isBrowser</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> ()</span><span style="color:#F97583">:</span><span style="color:#79B8FF"> boolean</span><span style="color:#F97583"> =&gt;</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#F97583"> typeof</span><span style="color:#E1E4E8"> window </span><span style="color:#F97583">!==</span><span style="color:#9ECBFF"> 'undefined'</span><span style="color:#F97583"> &amp;&amp;</span><span style="color:#F97583"> typeof</span><span style="color:#E1E4E8"> document </span><span style="color:#F97583">!==</span><span style="color:#9ECBFF"> 'undefined'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>Then, we have our <code>MutationObserver</code> setup:</p><pre class="shiki github-dark" style="background-color:#24292e;color:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> observer</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> MutationObserver</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=&gt;</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">  // logic to add buttons, we'll discuss this in a moment</span></span>
<span class="line"><span style="color:#E1E4E8">&nbsp; observer.</span><span style="color:#B392F0">disconnect</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">observer.</span><span style="color:#B392F0">observe</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.el.nativeElement, {</span></span>
<span class="line"><span style="color:#E1E4E8">&nbsp; childList: </span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">&nbsp; subtree: </span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<p><code>MutationObserver</code> is a browser API that provides the ability to watch for changes being made to the DOM tree. You can read more about it <a href="https://developer.mozilla.org/en-US/docs/Web/API/MutationObserver">here.</a> It is used here, because depending on how you handle loading the markdown content, it might be loaded asynchronously, after <code>ngAfterViewInit</code> has already fired.</p><p>First, we set up a callback function, that runs when the <code>MutationObserver</code> detects a change. We'll go over the details soon. For now, let's just focus on the last line inside the callback, <code>observer.disconnect()</code>. This line tells the <code>MutationObserver</code> that it is done, we don't need to be watching for changes anymore. In our case, the markdown content is loaded all at once, so disconnecting after the initial load is fine. It's encouraged even. If your usecase is different, this is something you may need to change.</p><p>Then, after the callback function's setup is done, we call <code>observer.observe</code> and pass the <code>nativeElement</code> contained by our <code>ElementRef</code> instance. We also pass a second, optional <code>options</code> parameter of type <code>MutationObserverInit</code>. For us, only the <code>childList</code> and <code>subtree</code> options are relevant, but there are some more you might want to know about. Read more about what options are availabe <a href="https://dom.spec.whatwg.org/#interface-mutationobserver">here.</a></p><p>With our setup, we tell the <code>MutationObserver</code> to watch for changes of not just the host element, but its children too. Setting <code>subtree: true</code> makes this work on all descendants at any level, not just on direct children of the host element.</p><h4 id="contents-of-the-callback-function">Contents of the callback function</h4>
<p>This is the part that runs when changes are detected by <code>MutationObserver</code>.</p><pre class="shiki github-dark" style="background-color:#24292e;color:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> preElements</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.el.nativeElement.</span><span style="color:#B392F0">querySelectorAll</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'pre'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">if</span><span style="color:#E1E4E8"> (preElements.</span><span style="color:#79B8FF">length</span><span style="color:#F97583"> ===</span><span style="color:#79B8FF"> 0</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">return</span><span style="color:#E1E4E8">;</span></span></code></pre>
<p>So far, it is pretty self-explanatory. We look up all the <code>pre</code> elements inside our host element. In markdown output, code blocks are wrapped in these typically. In case there are none, we are done here, there is no need to execute the rest of the logic.</p><pre class="shiki github-dark" style="background-color:#24292e;color:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#E1E4E8">preElements.</span><span style="color:#B392F0">forEach</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">pre</span><span style="color:#F97583">:</span><span style="color:#B392F0"> HTMLPreElement</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=&gt;</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  if</span><span style="color:#E1E4E8"> (pre.</span><span style="color:#B392F0">querySelector</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'button'</span><span style="color:#E1E4E8">)) </span><span style="color:#F97583">return</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#6A737D">  // rest of the logic, we'll look at it in a second</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<p>We need to add a copy button to each <code>pre</code> element, so we'll loop through them. We added a check here, to avoid adding multiple buttons if, for some reason, our observer fires multiple times. We only want to add a single copy button, but if you would want to do more complex logic, this might need to be adjusted a bit.</p><pre class="shiki github-dark" style="background-color:#24292e;color:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.renderer.</span><span style="color:#B392F0">setAttribute</span><span style="color:#E1E4E8">(pre, </span><span style="color:#9ECBFF">'class'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'relative pt-8'</span><span style="color:#E1E4E8">);</span></span></code></pre>
<p>This line is greatly dependent on the tech you use, but this is just the styling part. Since we are using <code>Tailwind CSS</code>, we just add the <code>relative</code> and <code>pt-8</code> utility classes to our <code>pre</code> element.</p><pre class="shiki github-dark" style="background-color:#24292e;color:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> button</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.renderer.</span><span style="color:#B392F0">createElement</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'button'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.renderer.</span><span style="color:#B392F0">setAttribute</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#E1E4E8">  button,</span></span>
<span class="line"><span style="color:#9ECBFF">  'class'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#9ECBFF">  'btn btn-xs btn-ghost absolute top-1 right-2 z-10'</span></span>
<span class="line"><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.renderer.</span><span style="color:#B392F0">setProperty</span><span style="color:#E1E4E8">(button, </span><span style="color:#9ECBFF">'textContent'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'Copy'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.renderer.</span><span style="color:#B392F0">appendChild</span><span style="color:#E1E4E8">(pre, button);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.renderer.</span><span style="color:#B392F0">listen</span><span style="color:#E1E4E8">(button, </span><span style="color:#9ECBFF">'click'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=&gt;</span><span style="color:#79B8FF"> this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">handleCopyButtonClick</span><span style="color:#E1E4E8">(pre, button));</span></span></code></pre>
<p>Here we see probably the most important part. Through our <code>Renderer2</code> instance, we create a new button and design it. Again, these classes are <code>Tailwind CSS</code>, and in this case, <code>daisyUI</code> dependent, so your solution might look different, but this is just styling.</p><p>Then, we set the <code>textContent</code> property of the button, in this case, to "Copy". With this step, our button instance is done, so we can add it to our <code>pre</code> element with our renderer instance's <code>appendChild</code> method. There is nothing more to do, than adding a <code>click</code> listener to our button, again, utilizin our renderer instance, but this time we use its <code>listen</code> method.</p><p>With this step completed, all we have left to do is to implement <code>handleCoppyButtonClick</code>.</p><h4 id="handling-the-button-click">Handling the button click</h4>
<p>This should be fairly straightforward.</p><pre class="shiki github-dark" style="background-color:#24292e;color:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#B392F0">handleCopyButtonClick</span><span style="color:#E1E4E8">(pre: HTMLPreElement, button: HTMLButtonElement): </span><span style="color:#F97583">void</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">&nbsp; const</span><span style="color:#79B8FF"> code</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> pre.</span><span style="color:#B392F0">querySelector</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'code'</span><span style="color:#E1E4E8">)?.textContent </span><span style="color:#F97583">??</span><span style="color:#9ECBFF"> ''</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">&nbsp; navigator.clipboard.</span><span style="color:#B392F0">writeText</span><span style="color:#E1E4E8">(code);</span></span>
<span class="line"><span style="color:#E1E4E8">&nbsp; button.textContent </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> 'Copied!'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#79B8FF">&nbsp; this</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">resetButtonText</span><span style="color:#E1E4E8">(button);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">resetButtonText</span><span style="color:#E1E4E8">(button: HTMLButtonElement): </span><span style="color:#F97583">void</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">&nbsp; setTimeout</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=&gt;</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">&nbsp; &nbsp; button.textContent </span><span style="color:#F97583">=</span><span style="color:#9ECBFF"> 'Copy'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#E1E4E8">&nbsp; }, </span><span style="color:#79B8FF">2000</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>We pass our <code>HTMLPreElement</code> and <code>HTMLButtonElement</code> instances. These are the <code>pre</code> element our loop is working on right now and the button we created in it. We read the <code>textContent</code> of the <code>code</code> block inside our <code>pre</code> element and add it to the clipboard through <code>navigator.clipboard</code>. Being able to do this so easily is due to the browser provided <code>Navigator</code> API, which you can look up <a href="https://developer.mozilla.org/en-US/docs/Web/API/Navigator">here.</a></p><p>Once we are done with writing to the clipboard, we add a bit of interactivity and change the <code>textContent</code> of our button to "Copied!", then we start a timer with <code>setTimeout</code> and after 2 seconds, we change it back to the original "Copy" text.</p><p>You might need to do some more styling, depending on your choice of tech, but this is basically it. It is a fairly straightforward process and in the end, the outcome should be something similar to, at least in functionality, to the copy buttons you can find in the code blocks all over this site, or even this article itself.</p></div><!----></analog-markdown></div></article><!----></div><!----></main><appfooter ngh="0"><footer class="footer-horizontal bg-neutral text-amber-100 p-4"><aside class="flex gap-8 justify-center"><a routerlink="/creative-commons" href="/creative-commons">© Creative Commons</a><a routerlink="/privacy" href="/privacy">Privacy Policy</a></aside></footer></appfooter></app-root>
    
  

<script id="ng-state" type="application/json">{"__nghData__":[{},{"c":{"0":[]}},{"t":{"0":"t5"},"c":{"0":[{"i":"t5","r":1}]}},{"c":{"2":[{"i":"c3636043166","r":1}]}}]}</script></body></html>