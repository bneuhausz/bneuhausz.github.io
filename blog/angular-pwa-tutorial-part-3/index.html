<!DOCTYPE html><html lang="en"><head>
    <meta charset="utf-8">
    <title>Angular PWA tutorial part 3 - Node backend for sending push notifications - bneuhausz.dev</title>
    <base href="/">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="impact-site-verification" value="fadbe9c7-c2b6-4441-b7ef-92e28101384e">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <script defer="" type="application/javascript" src="javascript/klaro/config.js"></script>
    <!-- <script defer src="/javascript/klaro/klaro.js"></script> -->
    <script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1479748760290806" crossorigin="anonymous">
    </script>
    <script>
      (function(w,d,e,u,f,l,n){w[f]=w[f]||function(){(w[f].q=w[f].q||[])
      .push(arguments);},l=d.createElement(e),l.async=1,l.src=u,
      n=d.getElementsByTagName(e)[0],n.parentNode.insertBefore(l,n);})
      (window,document,'script','https://assets.mailerlite.com/js/universal.js','ml');
      ml('account', '1754906');
    </script>
    <script type="module" crossorigin="" src="/assets/index-D8FjB5gC.js"></script>
    <link rel="stylesheet" crossorigin="" href="/assets/index-Dojvpfv1.css">
  <style ng-app-id="ng">[_nghost-ng-c572653062]{display:inline-block;width:var(--ng-icon__size, 1em);height:var(--ng-icon__size, 1em);line-height:initial;vertical-align:initial;overflow:hidden}[_nghost-ng-c572653062]     svg{width:inherit;height:inherit;vertical-align:inherit}@layer ng-icon{[_nghost-ng-c572653062]{color:var(--ng-icon__color, currentColor)}}</style><meta name="description" content="In part 3 of this series, we will implement a simple node backend to be able to send push notifications"><meta property="og:title" content="Angular PWA tutorial part 3 - Node backend for sending push notifications"><meta property="og:description" content="In part 3 of this series, we will implement a simple node backend to be able to send push notifications"><meta property="og:image" content="https://bneuhausz.dev/images/bneuhausz_dev_twitter.png"><meta property="og:image:alt" content="bneuhausz.dev site logo"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="Angular PWA tutorial part 3 - Node backend for sending push notifications"><meta name="twitter:description" content="In part 3 of this series, we will implement a simple node backend to be able to send push notifications"><meta name="twitter:image" content="https://bneuhausz.dev/images/bneuhausz_dev_twitter.png"><meta name="twitter:image:alt" content="bneuhausz.dev site logo"><script type="application/ld+json" id="blogpost-ldjson">{"@context":"https://schema.org","@type":"BlogPosting","headline":"Angular PWA tutorial part 3 - Node backend for sending push notifications","image":"/images/node_js_icon.svg","author":{"@type":"Person","name":"BÃ¡lint Neuhausz","url":"https://bneuhausz.dev"},"publisher":{"@type":"Organization","name":"bneuhausz.dev","logo":{"@type":"ImageObject","url":"https://bneuhausz.dev/images/nb_logo_small.avif"}},"datePublished":"2025-08-27T00:00:00.000Z","description":"In part 3 of this series, we will implement a simple node backend to be able to send push notifications"}</script><link rel="canonical" href="https://yourdomain.com/blog/angular-pwa-tutorial-part-3"></head>
  <body class="text-center h-screen w-screen overflow-x-hidden"><!--nghm-->
    <app-root ng-version="19.2.9" class="flex flex-col h-screen" ngh="3" ng-server-context="ssr-analog"><appheader ngh="0"><nav class="navbar bg-neutral text-amber-100 gap-2 px-8"><a routerlink="/" href="/"><img src="/images/nb_logo_small.avif" alt="logo of the site"></a><a routerlink="/blog" class="btn btn-square btn-ghost hover:bg-amber-100 hover:text-amber-900 px-8" href="/blog"> Blog </a><a routerlink="/about" class="btn btn-square btn-ghost hover:bg-amber-100 hover:text-amber-900 px-8" href="/about"> About </a><a routerlink="/contact" class="btn btn-square btn-ghost hover:bg-amber-100 hover:text-amber-900 px-8" href="/contact"> Contact </a><span class="flex-1"></span><a href="https://github.com/bneuhausz" target="_blank" rel="noopener"><div class="w-5 h-5 ml-3 bg-amber-100 github-icon"></div></a><a href="https://x.com/bneuhausz" target="_blank" rel="noopener" class="flex items-center ml-3"><ng-icon role="img" name="faBrandSquareXTwitter" _nghost-ng-c572653062="" aria-hidden="true" data-ng-icon-ssr="" style="--ng-icon__size: 1.5em;" ngh="0"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" fill="currentColor"><path d="M64 32C28.7 32 0 60.7 0 96V416c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64H64zm297.1 84L257.3 234.6 379.4 396H283.8L209 298.1 123.3 396H75.8l111-126.9L69.7 116h98l67.7 89.5L313.6 116h47.5zM323.3 367.6L153.4 142.9H125.1L296.9 367.6h26.3z"></path></svg></ng-icon></a><a href="mailto:bneuhauszdev@gmail.com" class="flex items-center ml-3"><ng-icon role="img" name="heroEnvelopeSolid" _nghost-ng-c572653062="" aria-hidden="true" data-ng-icon-ssr="" style="--ng-icon__size: 1.5em;" ngh="0"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon"><path d="M1.5 8.67v8.58a3 3 0 0 0 3 3h15a3 3 0 0 0 3-3V8.67l-8.928 5.493a3 3 0 0 1-3.144 0L1.5 8.67Z"></path><path d="M22.5 6.908V6.75a3 3 0 0 0-3-3h-15a3 3 0 0 0-3 3v.158l9.714 5.978a1.5 1.5 0 0 0 1.572 0L22.5 6.908Z"></path></svg></ng-icon></a></nav></appheader><main class="flex-1 py-4 md:px-4 bg-neutral-800 text-amber-100"><router-outlet></router-outlet><div slug="" ngh="2"><article class="flex flex-col items-center *:max-w-screen-xl *:mx-8 md:*:mx-32 pb-8"><img sizes="(max-width: 1280px) 100vw, 1280px" class="w-full h-auto" srcset="/images/node_js_header.svg 480w, /images/node_js_header.svg 800w, /images/node_js_header.svg 1280w" src="/images/node_js_header.svg" alt="nodejs image"><p class="flex flex-row items-center my-4"><span>2025-08-27</span><a href="https://github.com/bneuhausz" target="_blank" rel="noopener" class="flex items-center"><span class="w-5 h-5 ml-3 bg-amber-100 github-icon"></span></a><a href="https://x.com/bneuhausz" target="_blank" rel="noopener" class="flex items-center ml-3"><ng-icon role="img" name="faBrandSquareXTwitter" _nghost-ng-c572653062="" aria-hidden="true" data-ng-icon-ssr="" style="--ng-icon__size: 1.5em;" ngh="0"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" fill="currentColor"><path d="M64 32C28.7 32 0 60.7 0 96V416c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64H64zm297.1 84L257.3 234.6 379.4 396H283.8L209 298.1 123.3 396H75.8l111-126.9L69.7 116h98l67.7 89.5L313.6 116h47.5zM323.3 367.6L153.4 142.9H125.1L296.9 367.6h26.3z"></path></svg></ng-icon></a><a href="mailto:bneuhauszdev@gmail.com" class="flex items-center ml-3"><ng-icon role="img" name="heroEnvelopeSolid" _nghost-ng-c572653062="" aria-hidden="true" data-ng-icon-ssr="" style="--ng-icon__size: 1.5em;" ngh="0"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon"><path d="M1.5 8.67v8.58a3 3 0 0 0 3 3h15a3 3 0 0 0 3-3V8.67l-8.928 5.493a3 3 0 0 1-3.144 0L1.5 8.67Z"></path><path d="M22.5 6.908V6.75a3 3 0 0 0-3-3h-15a3 3 0 0 0-3 3v.158l9.714 5.978a1.5 1.5 0 0 0 1.572 0L22.5 6.908Z"></path></svg></ng-icon></a></p><div appcodecopybutton="" appexternallinks="" class="prose dark:prose-invert text-left mb-8"><analog-markdown ngh="1"><div class="analog-markdown"><h1 id="angular-pwa-tutorial-part-3---node-backend-for-sending-push-notifications">Angular PWA tutorial part 3 - Node backend for sending push notifications</h1>
<blockquote>
<sub>
<b>Changelog:</b><br>
<b>2025-08-28:</b> Added link to part 4.<br>
</sub></blockquote>
<p>Sending push notifications is a bit more complex than what we've dealt with before in this series and it requires a separate backend to provide security and reliability. In part 3 of this series, we will set up a very simple backend using Node.js and Express that will be more than enough for learning purposes.</p><p>You can find part 1 about the basic setup <a href="https://bneuhausz.dev/blog/angular-pwa-tutorial-part-1">here</a> and part 2 about notifying your users about a new version of your application being available <a href="https://bneuhausz.dev/blog/angular-pwa-tutorial-part-2">here.</a></p><h2 id="introducing-vapid">Introducing VAPID</h2>
<p>VAPID stands for Voluntary Application Server Identification. It is a security standard that allows push services to verify that the notification is coming from a legitimate application server and the server has permission to send messages to a specific user.</p><p>VAPID works using a public/private key pair. The public key can be safely shared with the client application, but the private key should be kept secret. The backend application will use the private key to sign the push requests you send and the push service will use the public key to verify the signature, to guarantee that:</p><ul>
<li>the request was sent by the authorized server</li>
<li>the message has not been tampered with</li>
</ul>
<p>Push services are provided by the browsers and their publishers (so Google or Mozilla for example), but in the past, if you wanted to send push notifications from a PWA, you had to register your app with each specific browser's push service to get an API key. VAPID enabled the standardization of this process.</p><p>This is likely more than enough to know about it, but in case you are interested, you can dive deeper <a href="https://datatracker.ietf.org/doc/html/draft-ietf-webpush-vapid-01">here.</a></p><h2 id="generating-your-vapid-keys">Generating your VAPID keys</h2>
<p>Later, we'll use the <a href="https://github.com/web-push-libs/web-push">web-push</a> package to send notifications, but we also need it to generate our VAPID keys, so let's install it:</p><pre class="shiki github-dark" style="background-color:#24292e;color:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#B392F0">npm</span><span style="color:#9ECBFF"> install</span><span style="color:#9ECBFF"> web-push</span><span style="color:#79B8FF"> -g</span></span></code></pre>
<p>Then, to generate our key pair, let's run the following:</p><pre class="shiki github-dark" style="background-color:#24292e;color:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#B392F0">web-push</span><span style="color:#9ECBFF"> generate-vapid-keys</span><span style="color:#79B8FF"> --json</span></span></code></pre>
<p>The output should look something like this, obviously with different values:</p><pre class="shiki github-dark" style="background-color:#24292e;color:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#E1E4E8">{</span><span style="color:#79B8FF">"publicKey"</span><span style="color:#E1E4E8">:</span><span style="color:#9ECBFF">"BFFkuSKeFvS13nlWyD..."</span><span style="color:#E1E4E8">,</span><span style="color:#79B8FF">"privateKey"</span><span style="color:#E1E4E8">:</span><span style="color:#9ECBFF">"52igq5YWuyXCaXls..."</span><span style="color:#E1E4E8">}</span></span></code></pre>
<p>For now, we can put our keys aside, but do save them somewhere, because we will need them in a bit.</p><h2 id="creating-our-nodejs-application">Creating our Node.js application</h2>
<p>First, for the sake of simplicity, in the root folder of our application, create a folder named <code>push-notification-server</code>, open your terminal inside it and run the following:</p><pre class="shiki github-dark" style="background-color:#24292e;color:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#B392F0">npm</span><span style="color:#9ECBFF"> init</span><span style="color:#79B8FF"> -y</span></span></code></pre>
<p>This will initialize a Node.js project with default values. You should now see a <code>package.json</code> file in your folder, more or less with these contents:</p><pre class="shiki github-dark" style="background-color:#24292e;color:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#79B8FF">  "name"</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"push-notification-server"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">  "version"</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"1.0.0"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">  "main"</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"index.js"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">  "scripts"</span><span style="color:#E1E4E8">: {</span></span>
<span class="line"><span style="color:#79B8FF">    "test"</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"echo </span><span style="color:#79B8FF">\"</span><span style="color:#9ECBFF">Error: no test specified</span><span style="color:#79B8FF">\"</span><span style="color:#9ECBFF"> &amp;&amp; exit 1"</span></span>
<span class="line"><span style="color:#E1E4E8">  },</span></span>
<span class="line"><span style="color:#79B8FF">  "keywords"</span><span style="color:#E1E4E8">: [],</span></span>
<span class="line"><span style="color:#79B8FF">  "author"</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">""</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">  "license"</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"ISC"</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#79B8FF">  "description"</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">""</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>If that is done, create a file named <code>index.js</code> inside the <code>push-notification-server</code> folder.</p><p>Now we'll install some packages we will use in our application:</p><pre class="shiki github-dark" style="background-color:#24292e;color:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#B392F0">npm</span><span style="color:#9ECBFF"> install</span><span style="color:#9ECBFF"> express</span><span style="color:#9ECBFF"> web-push</span><span style="color:#9ECBFF"> body-parser</span><span style="color:#9ECBFF"> dotenv</span><span style="color:#9ECBFF"> cors</span></span></code></pre>
<p>With that, our basic setup is mostly done, let's get to the implementation.</p><h2 id="setting-up-the-environment">Setting up the environment</h2>
<p>First things first, let's set up <code>dotenv</code>. We've already installed the package in the last section. Now, let's create a file in the <code>push-notification-server</code> folder and name it <code>.env</code>. In the GitHub repo for this project, you'll find a <code>.env-example</code> file with the following content:</p><pre class="shiki github-dark" style="background-color:#24292e;color:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#FFAB70">VAPID_PUBLIC_KEY</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">DUMMY PUBLIC KEY</span></span>
<span class="line"><span style="color:#FFAB70">VAPID_PRIVATE_KEY</span><span style="color:#F97583">=</span><span style="color:#E1E4E8">DUMMY PRIVATE KEY</span></span></code></pre>
<p>Add this to your <code>.env</code> file and replace the dummy data with your generated VAPID keys. If you're done with that, let's get to <code>index.js</code>.</p><h2 id="writing-the-application-logic">Writing the application logic</h2>
<p>To get it out of the way, add the following to the top of <code>index.js</code>:</p><pre class="shiki github-dark" style="background-color:#24292e;color:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> express </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> 'express'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> webpush </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> 'web-push'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> bodyParser </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> 'body-parser'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> dotenv </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> 'dotenv'</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">import</span><span style="color:#E1E4E8"> cors </span><span style="color:#F97583">from</span><span style="color:#9ECBFF"> 'cors'</span><span style="color:#E1E4E8">;</span></span></code></pre>
<p>After this, we will have access to the packages we've already installed. Now, to finish our environment setup and load the contents of the <code>.env</code> file into our application's environment, add the following line:</p><pre class="shiki github-dark" style="background-color:#24292e;color:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#E1E4E8">dotenv.</span><span style="color:#B392F0">config</span><span style="color:#E1E4E8">();</span></span></code></pre>
<p>Then, to set up <code>web-push</code> with our VAPID keys:</p><pre class="shiki github-dark" style="background-color:#24292e;color:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#E1E4E8">webpush.</span><span style="color:#B392F0">setVapidDetails</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#9ECBFF">  'mailto:example@example.com'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  process.env.</span><span style="color:#79B8FF">VAPID_PUBLIC_KEY</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  process.env.</span><span style="color:#79B8FF">VAPID_PRIVATE_KEY</span></span>
<span class="line"><span style="color:#E1E4E8">);</span></span></code></pre>
<p>The <code>setVapidDetails</code> function accepts 3 parameters. The public and private keys are self-explanatory, but it also expects a <code>subject</code> parameter. For learning purposes, this is mostly irrelevant, so you can just add the dummy address I did, but in a production environment, you should set it up with a real email or a contact form you can be reached at. It accepts a <code>mailto:</code> or an <code>https:</code> URL and it is used by push services to contact you in case of technical issues or if your private key got leaked and somebody is abusing it for example.</p><p>Now add the skeleton of our Express API:</p><pre class="shiki github-dark" style="background-color:#24292e;color:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> app</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> express</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#79B8FF"> port</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> 3000</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">let</span><span style="color:#E1E4E8"> subscription;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">app.</span><span style="color:#B392F0">use</span><span style="color:#E1E4E8">(</span><span style="color:#B392F0">cors</span><span style="color:#E1E4E8">({</span></span>
<span class="line"><span style="color:#E1E4E8">  origin: </span><span style="color:#9ECBFF">'http://localhost:8080'</span></span>
<span class="line"><span style="color:#E1E4E8">}));</span></span>
<span class="line"><span style="color:#E1E4E8">app.</span><span style="color:#B392F0">use</span><span style="color:#E1E4E8">(bodyParser.</span><span style="color:#B392F0">json</span><span style="color:#E1E4E8">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">app.</span><span style="color:#B392F0">post</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'/subscribe'</span><span style="color:#E1E4E8">, (</span><span style="color:#FFAB70">req</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">res</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=&gt;</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">  console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'Subscription received:'</span><span style="color:#E1E4E8">, req.body);</span></span>
<span class="line"><span style="color:#E1E4E8">  subscription </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> req.body;</span></span>
<span class="line"><span style="color:#E1E4E8">  res.</span><span style="color:#B392F0">status</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">201</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">json</span><span style="color:#E1E4E8">({ message: </span><span style="color:#9ECBFF">'subscription created'</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">app.</span><span style="color:#B392F0">post</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'/notify'</span><span style="color:#E1E4E8">, (</span><span style="color:#FFAB70">req</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">res</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=&gt;</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">  console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'Current subscription:'</span><span style="color:#E1E4E8">, subscription);</span></span>
<span class="line"><span style="color:#E1E4E8">  res.</span><span style="color:#B392F0">status</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">204</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">send</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">app.</span><span style="color:#B392F0">listen</span><span style="color:#E1E4E8">(port, () </span><span style="color:#F97583">=&gt;</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">  console.</span><span style="color:#B392F0">log</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">`Server is running at http://localhost:${</span><span style="color:#E1E4E8">port</span><span style="color:#9ECBFF">}`</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<p>Let me explain this. With the <code>express</code> function, we create our Express application, that we can access through the <code>app</code> variable. We set the <code>port</code> variable to 3000, which is a fairly standard port when developing Express applications.</p><p>The <code>subscription</code> variable will be used to store our active subscription. This is sufficient for learning, but the data will be lost every time our application is restarted, so make sure to use some kind of persistent storage in a production environment. Also, this approach handles only 1 subscriber at a time, so keep that in mind.</p><p>With the <code>cors</code> package, we configure our Express app to allow requests from the port 8080, where our client application runs. This can look wildly different depending on your production environment, but CORS is entirely out of scope of this tutorial. If you are interested, you can read about it <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Guides/CORS">here.</a></p><p>Then, we configure our app to use <code>body-parser</code> to automatically parse incoming requests with a JSON body and make the data available in <code>req.body</code>.</p><p>We've added two <code>POST</code> endpoints to our application, namely <code>/subscribe</code> and <code>/notify</code>. These are just dummy endpoints for now, but we will expand on these in a moment, to handle our subscription and notification logic.</p><p>Finally, with <code>app.listen</code>, we set our application to listen on port 3000.</p><p>With all this set up, you can run your application with</p><pre class="shiki github-dark" style="background-color:#24292e;color:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#B392F0">node</span><span style="color:#9ECBFF"> index.js</span></span></code></pre>
<p>Make sure to run this command in the <code>push-notification-server</code> folder. If everything works correctly, you should see <code>Server is running at http://localhost:3000</code> on your terminal.</p><p>While our app is running, we can send <code>POST</code> requests with Postman or the tool of your choice and we should see something like this as the output:</p><pre class="shiki github-dark" style="background-color:#24292e;color:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#B392F0">Server</span><span style="color:#9ECBFF"> is</span><span style="color:#9ECBFF"> running</span><span style="color:#9ECBFF"> at</span><span style="color:#9ECBFF"> http://localhost:3000</span></span>
<span class="line"><span style="color:#B392F0">Subscription</span><span style="color:#9ECBFF"> received:</span><span style="color:#9ECBFF"> {</span><span style="color:#9ECBFF"> test:</span><span style="color:#9ECBFF"> 'test'</span><span style="color:#9ECBFF"> }</span></span>
<span class="line"><span style="color:#B392F0">Current</span><span style="color:#9ECBFF"> subscription:</span><span style="color:#E1E4E8"> [ </span><span style="color:#9ECBFF">{</span><span style="color:#9ECBFF"> test:</span><span style="color:#9ECBFF"> 'test'</span><span style="color:#9ECBFF"> }</span><span style="color:#9ECBFF"> ]</span></span></code></pre>
<h2 id="implementing-subscription">Implementing subscription</h2>
<p>The subscription logic is very simple, we just add the incoming request body to our <code>subscription</code> variable. We will discuss the data we receive in the next post, when we will implement the frontend for this feature.</p><pre class="shiki github-dark" style="background-color:#24292e;color:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#E1E4E8">app.</span><span style="color:#B392F0">post</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'/subscribe'</span><span style="color:#E1E4E8">, (</span><span style="color:#FFAB70">req</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">res</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=&gt;</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">  subscription </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> req.body;</span></span>
<span class="line"><span style="color:#E1E4E8">  res.</span><span style="color:#B392F0">status</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">201</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">send</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<p>As you can see, the final code is functionally the same as before, we've just cleaned it up a little.</p><h2 id="sending-notifications">Sending notifications</h2>
<p>Since we have a very basic setup, this also becomes a fairly simple process. First, here is the complete endpoint:</p><pre class="shiki github-dark" style="background-color:#24292e;color:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#E1E4E8">app.</span><span style="color:#B392F0">post</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'/notify'</span><span style="color:#E1E4E8">, (</span><span style="color:#FFAB70">req</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">res</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=&gt;</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> payload</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    notification: {</span></span>
<span class="line"><span style="color:#E1E4E8">      title: </span><span style="color:#9ECBFF">'Test notification'</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">  };</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">  webpush.</span><span style="color:#B392F0">sendNotification</span><span style="color:#E1E4E8">(subscription, </span><span style="color:#79B8FF">JSON</span><span style="color:#E1E4E8">.</span><span style="color:#B392F0">stringify</span><span style="color:#E1E4E8">(payload))</span></span>
<span class="line"><span style="color:#E1E4E8">    .</span><span style="color:#B392F0">then</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=&gt;</span><span style="color:#E1E4E8"> res.</span><span style="color:#B392F0">status</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">204</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">send</span><span style="color:#E1E4E8">())</span></span>
<span class="line"><span style="color:#E1E4E8">    .</span><span style="color:#B392F0">catch</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">err</span><span style="color:#F97583"> =&gt;</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">      console.</span><span style="color:#B392F0">error</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'Error sending notification:'</span><span style="color:#E1E4E8">, err);</span></span>
<span class="line"><span style="color:#E1E4E8">      res.</span><span style="color:#B392F0">sendStatus</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">500</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    });</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<p>We have to create a notification. The only required field is the title, so we will go with that here, but you can set lots of things, like an icon or vibration patterns for example. You can read more about that <a href="https://developer.mozilla.org/en-US/docs/Web/API/Notification/Notification">here.</a></p><p>Then, we call <code>sendNotification</code> with our <code>subscription</code> and the stringified payload. That is literally all there is to it. Our application is ready to send notifications.</p><p>Again, we will discuss the contents of the <code>subscription</code> in the next part, when we implement the frontend, but until then, the complete code for this chapter is available <a href="https://github.com/bneuhausz/pwa-tutorial/tree/part-3">here.</a></p><p><a href="https://bneuhausz.dev/blog/angular-pwa-tutorial-part-4">Part 4 of this series, where we implement the frontend for our Express app has been released and you can find it here.</a></p></div><!----></analog-markdown></div><section class="flex flex-col md:flex-row gap-6 items-center"><div class="card w-full sm:w-96 h-60 bg-neutral text-amber-100 card-xl shadow-sm"><div class="card-body items-center"><h2 class="card-title">Follow me on <ng-icon role="img" name="faBrandSquareXTwitter" _nghost-ng-c572653062="" aria-hidden="true" data-ng-icon-ssr="" style="--ng-icon__size: 1.5em;" ngh="0"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" fill="currentColor"><path d="M64 32C28.7 32 0 60.7 0 96V416c0 35.3 28.7 64 64 64H384c35.3 0 64-28.7 64-64V96c0-35.3-28.7-64-64-64H64zm297.1 84L257.3 234.6 379.4 396H283.8L209 298.1 123.3 396H75.8l111-126.9L69.7 116h98l67.7 89.5L313.6 116h47.5zM323.3 367.6L153.4 142.9H125.1L296.9 367.6h26.3z"></path></svg></ng-icon>!</h2><p>I post updates and small snippets. If you find these posts interesting or useful, I'd greatly appreciate a follow!</p><div class="card-actions"><a target="_blank" rel="noopener" href="https://x.com/bneuhausz" class="btn btn-ghost hover:bg-amber-100 hover:text-amber-900">Follow</a></div></div></div><div class="card w-full sm:w-96 h-60 bg-neutral text-amber-100 card-xl shadow-sm"><div class="card-body items-center"><h2 class="card-title">Newsletter</h2><p>Sign up for my - probably - monthly newsletter to receive updates about new posts and possibly other content!</p><div class="card-actions"><button onclick="ml('show', 'QIrGIF', true)" class="ml-onclick-form btn btn-ghost hover:bg-amber-100 hover:text-amber-900">Subscribe</button></div></div></div></section></article><!----></div><!----></main><appfooter ngh="0"><footer class="footer-horizontal bg-neutral text-amber-100 p-4"><aside class="flex gap-8 justify-center"><a routerlink="/creative-commons" href="/creative-commons">Â© Creative Commons</a><a routerlink="/privacy" href="/privacy">Privacy Policy</a></aside></footer></appfooter></app-root>
    
  

<script id="ng-state" type="application/json">{"__nghData__":[{},{"c":{"0":[]}},{"t":{"0":"t5"},"c":{"0":[{"i":"t5","r":1}]}},{"c":{"2":[{"i":"c3950890797","r":1}]}}]}</script></body></html>