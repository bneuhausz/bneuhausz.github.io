<!DOCTYPE html><html lang="en"><head>
    <meta charset="utf-8">
    <title>AMQP 1.0 Messaging in .NET with Apache Artemis - Part 2 - bneuhausz.dev</title>
    <base href="/">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="impact-site-verification" value="fadbe9c7-c2b6-4441-b7ef-92e28101384e">
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <script defer="" type="application/javascript" src="javascript/klaro/config.js"></script>
    <!-- <script defer src="/javascript/klaro/klaro.js"></script> -->
    <script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1479748760290806" crossorigin="anonymous">
    </script>
    <script>
      (function(w,d,e,u,f,l,n){w[f]=w[f]||function(){(w[f].q=w[f].q||[])
      .push(arguments);},l=d.createElement(e),l.async=1,l.src=u,
      n=d.getElementsByTagName(e)[0],n.parentNode.insertBefore(l,n);})
      (window,document,'script','https://assets.mailerlite.com/js/universal.js','ml');
      ml('account', '1754906');
    </script>
    <script type="module" crossorigin="" src="/assets/index-Ds1THEmd.js"></script>
    <link rel="stylesheet" crossorigin="" href="/assets/index-guJYqCx_.css">
  <style ng-app-id="ng">[_nghost-ng-c572653062]{display:inline-block;width:var(--ng-icon__size, 1em);height:var(--ng-icon__size, 1em);line-height:initial;vertical-align:initial;overflow:hidden}[_nghost-ng-c572653062]     svg{width:inherit;height:inherit;vertical-align:inherit}@layer ng-icon{[_nghost-ng-c572653062]{color:var(--ng-icon__color, currentColor)}}</style><meta name="description" content="In this edition, we'll take a look at sending messages to an address we set up in Artemis"><meta property="og:title" content="AMQP 1.0 Messaging in .NET with Apache Artemis - Part 2"><meta property="og:description" content="In this edition, we'll take a look at sending messages to an address we set up in Artemis"><meta property="og:image" content="https://bneuhausz.dev/images/bneuhausz_dev_twitter.png"><meta property="og:image:alt" content="bneuhausz.dev site logo"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="AMQP 1.0 Messaging in .NET with Apache Artemis - Part 2"><meta name="twitter:description" content="In this edition, we'll take a look at sending messages to an address we set up in Artemis"><meta name="twitter:image" content="https://bneuhausz.dev/images/bneuhausz_dev_twitter.png"><meta name="twitter:image:alt" content="bneuhausz.dev site logo"><script type="application/ld+json" id="blogpost-ldjson">{"@context":"https://schema.org","@type":"BlogPosting","headline":"AMQP 1.0 Messaging in .NET with Apache Artemis - Part 2","image":"/images/dotnet/dotnet-logo.svg","author":{"@type":"Person","name":"Bálint Neuhausz","url":"https://bneuhausz.dev"},"publisher":{"@type":"Organization","name":"bneuhausz.dev","logo":{"@type":"ImageObject","url":"https://bneuhausz.dev/images/nb_logo_small.avif"}},"datePublished":"2025-10-01T00:00:00.000Z","description":"In this edition, we'll take a look at sending messages to an address we set up in Artemis"}</script><link rel="canonical" href="https://yourdomain.com/blog/dotnet-activemq-artemis-part-2"></head>
  <body class="text-center h-screen w-screen overflow-x-hidden"><!--nghm-->
    <app-root ng-version="19.2.9" class="flex flex-col h-screen" ngh="3" ng-server-context="ssr-analog"><appheader ngh="0"><nav class="navbar bg-neutral text-amber-100 gap-2 px-8"><a routerlink="/" href="/"><img src="/images/nb_logo_small.avif" alt="logo of the site"></a><a routerlink="/blog" class="btn btn-square btn-ghost hover:bg-amber-100 hover:text-amber-900 px-8" href="/blog"> Blog </a><a routerlink="/about" class="btn btn-square btn-ghost hover:bg-amber-100 hover:text-amber-900 px-8" href="/about"> About </a><span class="flex-1"></span><a href="https://github.com/bneuhausz" target="_blank" rel="noopener"><div class="w-5 h-5 ml-3 bg-amber-100 github-icon"></div></a><a href="mailto:bneuhauszdev@gmail.com" class="flex items-center ml-3"><ng-icon role="img" name="heroEnvelopeSolid" _nghost-ng-c572653062="" aria-hidden="true" data-ng-icon-ssr="" style="--ng-icon__size: 1.5em;" ngh="0"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon"><path d="M1.5 8.67v8.58a3 3 0 0 0 3 3h15a3 3 0 0 0 3-3V8.67l-8.928 5.493a3 3 0 0 1-3.144 0L1.5 8.67Z"></path><path d="M22.5 6.908V6.75a3 3 0 0 0-3-3h-15a3 3 0 0 0-3 3v.158l9.714 5.978a1.5 1.5 0 0 0 1.572 0L22.5 6.908Z"></path></svg></ng-icon></a></nav></appheader><main class="flex-1 py-4 md:px-4 bg-neutral-800 text-amber-100"><router-outlet></router-outlet><div slug="" ngh="2"><article class="flex flex-col items-center *:max-w-screen-xl *:mx-8 md:*:mx-32 pb-8"><img sizes="(max-width: 1280px) 100vw, 1280px" class="w-full h-auto" srcset="/images/activemq/activemq-2.svg 480w, /images/activemq/activemq-2.svg 800w, /images/activemq/activemq-2.svg 1280w" src="/images/activemq/activemq-2.svg" alt="apache activemq artemis logo"><p class="flex flex-row items-center my-4"><span>2025-10-01</span><a href="https://github.com/bneuhausz" target="_blank" rel="noopener" class="flex items-center"><span class="w-5 h-5 ml-3 bg-amber-100 github-icon"></span></a><a href="mailto:bneuhauszdev@gmail.com" class="flex items-center ml-3"><ng-icon role="img" name="heroEnvelopeSolid" _nghost-ng-c572653062="" aria-hidden="true" data-ng-icon-ssr="" style="--ng-icon__size: 1.5em;" ngh="0"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" data-slot="icon"><path d="M1.5 8.67v8.58a3 3 0 0 0 3 3h15a3 3 0 0 0 3-3V8.67l-8.928 5.493a3 3 0 0 1-3.144 0L1.5 8.67Z"></path><path d="M22.5 6.908V6.75a3 3 0 0 0-3-3h-15a3 3 0 0 0-3 3v.158l9.714 5.978a1.5 1.5 0 0 0 1.572 0L22.5 6.908Z"></path></svg></ng-icon></a></p><div appcodecopybutton="" appexternallinks="" class="prose dark:prose-invert text-left mb-8"><analog-markdown ngh="1"><div class="analog-markdown"><h1 id="amqp-10-messaging-in-net-with-apache-artemis---part-2">AMQP 1.0 Messaging in .NET with Apache Artemis - Part 2</h1>
<blockquote>
<sub>
<b>Changelog:</b><br>
<b>2025-10-03:</b> Added link to part 3.<br>
</sub></blockquote>
<p>In <a href="https://bneuhausz.dev/blog/dotnet-activemq-artemis-part-1">part 1 of this series</a>, we've created a dockerized Artemis instance and our starting .NET application. This time, we'll take a look at creating an address on the Artemis console and sending a message to it.</p><p><a href="https://github.com/bneuhausz/dotnet-amqp-messaging/tree/part-2">The source code for this article can be found here.</a></p><h2 id="creating-the-address">Creating the address</h2>
<p>First, make sure that your Artemis container is up and running, then navigate to <a href="http://localhost:8161">http://localhost:8161</a> to access the Artemis console. After logging in with the credentials we've set up in our <code>docker-compose.yml</code> file, you should find yourself on the dashboard's Status tab. Right now, we are interested in the Addresses tab, so let's navigate there.</p><p><img src="/images/dotnet-artemis/part-2/create_address_1.avif" alt="addresses tab"></p><p>Once you're there, you'll see the list of the default addresses, but also, you'll see the Create Address button.</p><p><img src="/images/dotnet-artemis/part-2/create_address_2.avif" alt="create address"></p><p>If you click on it, the Create Address modal will pop up. For this demo, we'll add the demo-target name to our address and set it to Anycast, then click the Create Address button.</p><p><img src="/images/dotnet-artemis/part-2/create_address_3.avif" alt="create address modal"></p><p>Sadly, the Artemis console is not refreshing automatically, so you'll have to do that yourself to see our new address. After you did it, you should see something like this:</p><p><img src="/images/dotnet-artemis/part-2/create_address_4.avif" alt="create address"></p><p>As you can see, our demo-target address has been created and the Queue Count and Message Count values are 0. If you want to manually create a queue for this address, you can do so by clicking the three dots icon at the end of the row, but we'll let Artemis deal with that automatically for this simple demo. When we send our first message, a queue will be created for us.</p><h3 id="a-small-note-about-routing-type---anycast-vs-multicast">A small note about Routing Type - Anycast vs Multicast</h3>
<p>In ActiveMQ Artemis, an address is a logical destination where the messages are sent. When creating the address, you have to decide what routing type you want to use. The options are anycast and multicast.</p><p>A deep dive is out of scope here, but in short, anycast, or in other words, point-to-point, is basically a traditional queue. When a message arrives, the broker will distribute the message to a single consumer out of the available consumers. This effectively works as a load balancer.</p><p>On the other hand, multicast is a topic. When a message arrives to a multicast address, Artemis delivers that message to every single consumer. It basically follows the pub/sub model.</p><h2 id="sending-a-message">Sending a message</h2>
<p>It's time to set up our .net application to be able to send messages. First, let's create a new file, <code>AmqpSender.cs</code> with the following content:</p><pre class="shiki github-dark" style="background-color:#24292e;color:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#F97583">using</span><span style="color:#B392F0"> Amqp</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">namespace</span><span style="color:#B392F0"> dotnet_amqp_messaging</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">public</span><span style="color:#F97583"> class</span><span style="color:#B392F0"> AmqpSender</span></span>
<span class="line"><span style="color:#E1E4E8">{</span></span>
<span class="line"><span style="color:#F97583">    public</span><span style="color:#F97583"> async</span><span style="color:#B392F0"> Task</span><span style="color:#B392F0"> SendMessageAsync</span><span style="color:#E1E4E8">(</span><span style="color:#F97583">string</span><span style="color:#B392F0"> messageBody</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">    {</span></span>
<span class="line"><span style="color:#B392F0">        Connection</span><span style="color:#E1E4E8">? </span><span style="color:#B392F0">connection</span><span style="color:#F97583"> =</span><span style="color:#79B8FF"> null</span><span style="color:#E1E4E8">;</span></span>
<span class="line"><span style="color:#F97583">        try</span></span>
<span class="line"><span style="color:#E1E4E8">        {</span></span>
<span class="line"><span style="color:#B392F0">            Address</span><span style="color:#B392F0"> address</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Address</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"localhost"</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">5672</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"admin"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"admin"</span><span style="color:#E1E4E8">, </span><span style="color:#B392F0">scheme</span><span style="color:#E1E4E8">: </span><span style="color:#9ECBFF">"amqp"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">            connection </span><span style="color:#F97583">=</span><span style="color:#F97583"> await</span><span style="color:#E1E4E8"> Connection.Factory.</span><span style="color:#B392F0">CreateAsync</span><span style="color:#E1E4E8">(address);</span></span>
<span class="line"><span style="color:#F97583">            var</span><span style="color:#B392F0"> session</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Session</span><span style="color:#E1E4E8">(connection);</span></span>
<span class="line"><span style="color:#F97583">            var</span><span style="color:#B392F0"> sender</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> SenderLink</span><span style="color:#E1E4E8">(session, </span><span style="color:#9ECBFF">"demo-sender"</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">"demo-target"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">            var</span><span style="color:#B392F0"> message</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Message</span><span style="color:#E1E4E8">(messageBody);</span></span>
<span class="line"><span style="color:#F97583">            await</span><span style="color:#E1E4E8"> sender.</span><span style="color:#B392F0">SendAsync</span><span style="color:#E1E4E8">(message);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">            Console.</span><span style="color:#B392F0">WriteLine</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"Message sent to AMQP topic"</span><span style="color:#E1E4E8">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">            await</span><span style="color:#E1E4E8"> sender.</span><span style="color:#B392F0">CloseAsync</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">            await</span><span style="color:#E1E4E8"> session.</span><span style="color:#B392F0">CloseAsync</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#F97583">        catch</span><span style="color:#E1E4E8"> (</span><span style="color:#B392F0">Exception</span><span style="color:#B392F0"> ex</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">        {</span></span>
<span class="line"><span style="color:#E1E4E8">            Console.</span><span style="color:#B392F0">WriteLine</span><span style="color:#E1E4E8">(ex.Message);</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#F97583">        finally</span></span>
<span class="line"><span style="color:#E1E4E8">        {</span></span>
<span class="line"><span style="color:#F97583">            if</span><span style="color:#E1E4E8"> (connection </span><span style="color:#F97583">!=</span><span style="color:#79B8FF"> null</span><span style="color:#E1E4E8">)</span></span>
<span class="line"><span style="color:#E1E4E8">            {</span></span>
<span class="line"><span style="color:#F97583">                await</span><span style="color:#E1E4E8"> connection.</span><span style="color:#B392F0">CloseAsync</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">            }</span></span>
<span class="line"><span style="color:#E1E4E8">        }</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>Make sure the <code>using Amqp</code> statement is present, so you can access the <a href="https://www.nuget.org/packages/AMQPNetLite.Core/">AMQPNetLite.Core package</a>, that we've already installed.</p><p>Our method accepts a single <code>string</code> parameter, that will be the content of the message we want to send. We create an <code>Address</code> instance with the necessary information for the Artemis connection. Obviously, you should not handle your config, especially your secrets, like we do it here, but proper configuration is not our scope in this series.</p><p>Then, we use <code>Connection.Factory.CreateAsync</code> with our address passed to it to create our <code>Connection</code> instance. After that, we can create a <code>Session</code> instance, which our connection is supplied to. The last piece of the plumbing work is creating a <code>SenderLink</code>, which receives our session, a unique name for the link, and lastly, the target address.</p><p>It is very important that the target address we pass to <code>new SenderLink()</code> matches the name of the address we've created in Artemis.</p><p>With these done, all we have left to do is creating a <code>Message</code> instance, call <code>SendAsync</code> and close our connection.</p><p>This is all of the logic we need to send messages, so let's use it. Replace the contents of <code>Program.cs</code> with this:</p><pre class="shiki github-dark" style="background-color:#24292e;color:#e1e4e8" tabindex="0"><code><span class="line"><span style="color:#F97583">using</span><span style="color:#B392F0"> dotnet_amqp_messaging</span><span style="color:#E1E4E8">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">var</span><span style="color:#B392F0"> sender</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> AmqpSender</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">await</span><span style="color:#E1E4E8"> sender.</span><span style="color:#B392F0">SendMessageAsync</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">"demo message"</span><span style="color:#E1E4E8">);</span></span></code></pre>
<p>Now we are ready to run our application. If we've done everything correctly, after running our program, the output should be something like this:</p><p><img src="/images/dotnet-artemis/part-2/program_output.avif" alt="output"></p><p>After the program has executed successfully and we check the Addresses tab, the automatic queue for our address should be created and Message Count should be 1 too.</p><p><img src="/images/dotnet-artemis/part-2/message_sent_1.avif" alt="address message count increased"></p><p>If we navigate to the Queues tab, we should see the demo-target queue with a Message Count of 1.</p><p><img src="/images/dotnet-artemis/part-2/message_sent_2.avif" alt="queue created"></p><p>Clicking the name of the queue lets us checking what's inside:</p><p><img src="/images/dotnet-artemis/part-2/message_sent_3.avif" alt="browse queue contents"></p><p>Now let's click on the Message ID to see the message content:</p><p><img src="/images/dotnet-artemis/part-2/message_sent_4.avif" alt="message content"></p><p>And we're done! Our AmqpSender is fully functional. Next time we'll take a look at receiving messages sent by Artemis.</p><p><a href="https://bneuhausz.dev/blog/dotnet-activemq-artemis-part-3">Part 3, covering actually receiving messages from Artemis is out. Take a look!</a></p></div><!----></analog-markdown></div></article><!----></div><!----></main><appfooter ngh="0"><footer class="footer-horizontal bg-neutral text-amber-100 p-4"><aside class="flex gap-8 justify-center"><a routerlink="/creative-commons" href="/creative-commons">© Creative Commons</a><a routerlink="/privacy" href="/privacy">Privacy Policy</a></aside></footer></appfooter></app-root>
    
  

<script id="ng-state" type="application/json">{"__nghData__":[{},{"c":{"0":[]}},{"t":{"0":"t5"},"c":{"0":[{"i":"t5","r":1}]}},{"c":{"2":[{"i":"c3636043166","r":1}]}}]}</script></body></html>